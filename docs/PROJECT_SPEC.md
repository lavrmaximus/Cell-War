# Cell War - Техническое задание

## Общее описание
**Cell War** - пошаговая стратегическая игра в духе "бумажных" игр с захватом территорий, экономикой и тактическими боями. Игра поддерживает одиночную игру против ИИ, hot-seat мультиплеер и онлайн-режим.

## Технический стек
- **Фронтенд**: React + TypeScript
- **Бэкенд**: Python + Flask
- **База данных**: PostgreSQL (для онлайн-режима)
- **Хостинг**: Vercel (фронтенд) + Railway (бэкенд)

## Архитектура

### Локальная разработка
```text
┌──────────────────┐    HTTP REST API   ┌──────────────────┐
│   React Client   │ ←────────────────→ │   Flask Server   │
│ (localhost:3000) │                    │ (localhost:5000) │
└──────────────────┘                    └──────────────────┘
```

### Продакшен
```text
┌──────────────────┐     HTTPS API     ┌──────────────────┐
│ React on Vercel  │ ←───────────────→ │ Flask on Railway │
│                  │                   │                  │
└──────────────────┘                   └──────────────────┘
│
↓
PostgreSQL
```


## Фазы разработки

### Фаза 1: Минимальная рабочая версия (MVP)
**Цель**: Рабочая игра 1v1 на одном ПК

#### 1.1. Бэкенд (Python/Flask)
- [ ] Базовый Flask сервер с CORS
- [ ] Модель данных игры:
  ```python
  from typing import Dict, Tuple

  class Player:
      pass
  
  class Cell:
      pass

  class GameState:
      players: Dict[str, Player]
      cells: Dict[Tuple[int, int], Cell]
      current_player: str
      turn_number: int
  ```
API endpoints:
```
POST /api/game - создать новую игру
GET /api/game/:id - получить состояние игры
POST /api/game/:id/action - выполнить действие
POST /api/game/:id/end_turn - закончить ход
```

#### 1.2. Фронтенд (React)
Базовые компоненты:
- GameBoard - игровое поле 20x20
- Cell - отображение клетки с состоянием
- PlayerPanel - информация об игроке

Система взаимодействия:
- Выбор действия (горячие клавиши)
- Предпросмотр действия при наведении
- Визуализация доступных действий

#### 1.3. Игровая логика
- Базовая механика захвата клеток
- Экономическая система (фермы, доход)
- Система защиты территорий
- Механика колоний и целостности территорий

### Фаза 2: Улучшения и полировка
**Цель**: Красивый интерфейс, анимации, звуки

#### 2.1. Визуальные улучшения
Спрайты для элементов (16x16):
- Фермы, горы, холмы, реки
- Разные цвета команд

Анимации:
- Вспышка при захвате клетки
- Получение дохода (монетки летят к счетчику)
- Плавное изменение цвета территории

Звуковые эффекты:
- Захват клетки
- Получение дохода
- Конец хода

#### 2.2. Дополнительные возможности
- Редактор карт
- Разные пресеты карт (20x20, 30x30, случайная генерация)
- Система сохранения игры (LocalStorage)

### Фаза 3: Онлайн-режим
**Цель**: Полноценный онлайн-мультиплеер

#### 3.1. База данных и аутентификация
Модели PostgreSQL:
- Пользователи
- Игры
- Рейтинги

- OAuth аутентификация (Google)
- Система сессий

#### 3.2. Онлайн-функциональность
Система лобби:
- Создание/поиск игр
- Настройка параметров (размер карты, кол-во игроков)

Рейтинговая система (ELO):
- Матчмейкинг
- Таблица лидеров

#### 3.3. Real-time обновления
- WebSocket соединения для live-обновлений
- Уведомления о ходе противника
- Чат в лобби

## API спецификация
### Модели данных
#### Game
```typescript
interface Game {
  id: string;
  players: Player[];
  cells: Cell[][];
  currentPlayerId: string;
  turnNumber: number;
  gameStatus: 'waiting' | 'active' | 'finished';
  winnerId?: string;
}
```
#### Player
```typescript
interface Player {
  id: string;
  name: string;
  color: string;
  gold: number;
  income: number;
  territory: number;
}
```
#### Cell
```typescript
interface Cell {
  x: number;
  y: number;
  ownerId?: string;
  type: 'plain' | 'mountain' | 'hill' | 'water';
  building?: 'farm' | null;
  defense: number;
}
```
### Endpoints
#### Игровые действия
```text
- **POST** `/api/games` - Создание новой игры
- **GET** `/api/games/:gameId` - Получение состояния игры
- **POST** `/api/games/:gameId/actions` - Выполнение действия (захват, строительство, усиление)
- **POST** `/api/games/:gameId/end-turn` - Завершение хода
```

#### Действие payload
```typescript
interface GameAction {
  type: 'CAPTURE' | 'BUILD_FARM' | 'UPGRADE_DEFENSE';
  playerId: string;
  cell: { x: number; y: number };
  // Дополнительные параметры в зависимости от типа
}
```
## Структура проекта
```text
cell-war/
├── backend/
│   ├── app/
│   │   ├── models/          # Модели данных
│   │   ├── game_logic/      # Игровая логика
│   │   ├── api/            # API endpoints
│   │   └── utils/          # Вспомогательные функции
│   ├── requirements.txt
│   └── main.py
├── frontend/
│   ├── src/
│   │   ├── components/     # React компоненты
│   │   ├── hooks/          # Кастомные хуки
│   │   ├── types/          # TypeScript типы
│   │   └── utils/          # Вспомогательные функции
│   ├── public/
│   └── package.json
└── docs/
    ├── PROJECT_SPEC.md
    └── GAME_RULES.md
```
## Начало разработки
### Локальная настройка
#### Бэкенд:
```bash
cd backend
python -m venv venv
source venv/bin/activate  # или venv\Scripts\activate на Windows
pip install -r requirements.txt
python main.py
```
#### Фронтенд:
```bash
cd frontend
npm install
npm start
```
## Примечания по реализации
### Критические компоненты
- Синхронизация состояния - гарантировать консистентность между клиентом и сервером
- Валидация действий - проверка возможности выполнения действия на сервере
- Обработка ошибок - понятные сообщения об ошибках для пользователя

### Производительность
- Оптимизация перерисовки игрового поля в React
- Эффективные алгоритмы проверки целостности территорий
- Кэширование частых вычислений

Это ТЗ будет живым документом и может уточняться по мере разработки.
